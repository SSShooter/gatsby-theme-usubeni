---
path: '/docker-tutorial'
date: '2020-02-02T10:08:00.022Z'
title: 'docker ç®€å•å…¥é—¨'
tags: ['coding', 'docker']
---

ç®€å•æ¥è¯´ï¼Œdocker å¯ä»¥ç»™ä½ çš„åº”ç”¨åˆ›é€ ä¸€ä¸ª**é•œåƒ**ï¼Œä¹‹åä½ å¸¦ç€è¿™ä¸ªé•œåƒå°±å¯ä»¥åœ¨å…¶ä»–ä¸»æœºã€ç”šè‡³å…¶ä»–ç³»ç»Ÿè½»æ¾ä»¥åŸæ¥çš„é…ç½®è¿è¡Œä½ çš„åº”ç”¨ï¼Œè¿™æ ·çš„ä¸€ä¸ªåº”ç”¨åé¢æˆä¸º**å®¹å™¨**ã€‚ä½¿ç”¨ docker ä¼šæ¯”ç›´æ¥ä½¿ç”¨è™šæ‹Ÿæœºæ‰€éœ€çš„æ€§èƒ½éœ€æ±‚è¦å°‘å¾ˆå¤šï¼Œå› æ­¤ä½ å¯ä»¥åœ¨ä¸»æœºè¿è¡Œå¤šä¸ªå®¹å™¨å¹¶ä¿è¯æ€§èƒ½ã€‚è€Œä¸”å› ä¸ºå®¹å™¨çš„ç›¸äº’åˆ†ç¦»ï¼Œå¯ä»¥å‡å°‘ç¯å¢ƒé—´çš„ç›¸äº’å½±å“ï¼Œé¿å…ä¸€äº›éš¾ä»¥ debug çš„é”™è¯¯ã€‚

åœ¨å­¦ä¹  docker ä¹‹å‰å¿…é¡»çŸ¥é“ï¼Œ[docker å®˜æ–¹æ–‡æ¡£](https://docs.docker.com/)æ˜¯æˆ‘ä»¬çš„å¥½è€å¸ˆï¼Œå†™å¾—éå¸¸è¯¦ç»†ï¼Œæ–‡æ¡£åºå¤§ä½†æ˜¯ä¸ä¼šæ˜¾å¾—å¾ˆæ··ä¹±ï¼Œè¿·èŒ«æ—¶å¯ä»¥ç¿»ä¸€ç¿»ã€‚

## docker æ¶æ„

![docker æ¶æ„](architecture.svg)

æœ€å·¦ä¾§çš„å®¢æˆ·ç«¯ï¼ˆclientï¼‰æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå®¢æˆ·ç«¯ï¼Œå¯ä»¥é€šè¿‡ api æ§åˆ¶ docker å®ˆæŠ¤è¿›ç¨‹ï¼ˆdaemonï¼‰ã€‚è¿™ä¸ªå®ˆæŠ¤è¿›ç¨‹å¯ä»¥æ˜¯æœ¬æœºçš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–æœåŠ¡å™¨çš„ï¼Œå®ˆæŠ¤è¿›ç¨‹ç®¡ç†ç€å±äºä»–çš„é•œåƒï¼ˆimageï¼‰å’Œå®¹å™¨ï¼ˆcontainerï¼‰ã€‚å³ä¾§æŒ‡çš„æ˜¯ä½ å¯ä»¥åœ¨è¿œç¨‹è·å–å„å¼å„æ ·å·²ç»åšå¥½çš„é•œåƒï¼Œç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šï¼Œè®©ä½ çš„å¼€å‘å˜å¾—æ›´è½»æ¾ï¼è¿™äº›è·å–é•œåƒçš„æºæœ€å¸¸ç”¨çš„è‚¯å®šæ˜¯ Docker Hubï¼Œä»–æ˜¯ docker å®˜æ–¹é•œåƒå‚¨å­˜ä¸­å¿ƒã€‚

ä¸‹é¢çš„é‡ç‚¹æ˜¯é•œåƒå’Œå®¹å™¨ã€‚

## é•œåƒ

å°±åƒä»¥å‰çš„è™šæ‹Ÿå…‰é©±ï¼Œæ‰“å¼€ iso é•œåƒå°±èƒ½è¿˜åŸå…‰ç›˜é‡Œçš„æ‰€æœ‰æ–‡ä»¶ï¼Œdocker çš„é•œåƒä¹Ÿæ˜¯å¦‚æ­¤ã€‚

### ç”Ÿæˆé•œåƒ

ä½¿ç”¨ Dockerfile é€šè¿‡ `docker image build` æ„å»ºé•œåƒã€‚ï¼ˆä½ ä¹Ÿå¯ä»¥ä¸Šä¼ å·¥ç¨‹åˆ° docker hub è¿›è¡Œæ„å»ºï¼Œä½†æ˜¯æ²¡æœ‰å¿…è¦ï¼Œé™¤éä½ çš„ç”µè„‘çœŸçš„è£…ä¸ä¸‹ docker äº† ğŸ˜‚ï¼‰

ä»¥ web å‰ç«¯å·¥ç¨‹ä¸ºä¾‹ï¼Œä»¥ä¸‹æ˜¯ ant design pro çš„ Dockerfileï¼š

```
FROM circleci/node:latest-browsers

WORKDIR /usr/src/app/
USER root
COPY package.json ./
RUN yarn

COPY ./ ./

RUN npm run test:all

RUN npm run fetch:blocks

CMD ["npm", "run", "build"]
```

- FROM çš„æ„æ€æ˜¯ä»¥æŒ‡å®šé•œåƒä¸ºåŸºç¡€ç”Ÿæˆæ–°é•œåƒï¼Œè·Ÿç±»å·®ä¸å¤šï¼Œä¸€ä¸ªç»§æ‰¿ä¸€ä¸ªï¼Œä¸€å±‚ä¸€å±‚åœ°æŠ½è±¡ä¸‹å»
- WORKDIR æŒ‡å®šå®¹å™¨ç›®å½•
- COPY A B è¡¨ç¤ºä» dockerfile ç›®å½•çš„ A å¤åˆ¶åˆ°å®¹å™¨ç›®å½• B
- RUN æ‰§è¡Œåœ¨å®¹å™¨åˆ›å»ºå‰ï¼Œä¹Ÿå°±æ˜¯ RUN äº§ç”Ÿçš„ç»“æœåŒ…å«åœ¨é•œåƒä¸­
- CMD æ‰§è¡Œåœ¨å®¹å™¨åˆ›å»ºåï¼Œä¸€èˆ¬ç”¨äºå¯åŠ¨æœåŠ¡ã€‚åªèƒ½å­˜åœ¨ä¸€å¥ CMD å‘½ä»¤

ä¸€å¥è¯æ€»ç»“ï¼š**å·¥ç¨‹ + dockerfile = é•œåƒ**

æ›´å¤šé…ç½®è¯·å‚è€ƒ [dockerfile æ–‡æ¡£](https://docs.docker.com/engine/reference/builder/)ã€‚

### è·å–å·²æœ‰é•œåƒ

é•œåƒåˆ†äº«æ˜¯ docker é‡è¦çš„ä¸€ç¯ï¼Œä½ å¯ä»¥åœ¨ docker hub ä¸Šæ‰¾åˆ°å¾ˆå¤šå®ç”¨çš„ç°æˆé•œåƒã€‚

è¿è¡Œ `docker image pull` åŠ ä¸Š username/imagename å°±èƒ½æŠŠé•œåƒæ‹‰å–åˆ°æœ¬åœ°ï¼Œä¾‹å¦‚ï¼š

```
docker image pull library/hello-world
```

å…¶ä»–å¸¸ç”¨æ“ä½œè¿˜æœ‰ï¼š

```
docker image ls
docker image rm
```

## å®¹å™¨

å®¹å™¨ï¼ˆcontainerï¼‰çš„æ¦‚å¿µæ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯**é•œåƒçš„ä¸€ä¸ªè¿è¡Œå®ä¾‹**ã€‚é€šè¿‡è¿è¡Œé•œåƒå¯ä»¥ç”Ÿæˆå®¹å™¨ï¼Œä¾‹å¦‚ï¼š

```
docker container run hello-world
```

ä¸€å¥è¯æ€»ç»“ï¼š**è¿è¡Œé•œåƒ -> å®¹å™¨**

å…¶ä»–å¸¸ç”¨æ“ä½œè¿˜æœ‰ï¼š

```
docker container ls
docker container rm
```

## docker compose

é¡ºä¾¿ç®€å•æä¸€ä¸‹ docker composeã€‚

ä½¿ç”¨ composeï¼Œä½ å¯ä»¥åœ¨å®¹å™¨çš„åŸºç¡€ä¸Šç›¸äº’æ­é…å…¶ä»–å®¹å™¨ã€‚

è¿è¡Œ `docker-compose up` ä¼šç›´æ¥ä¸‹è½½å½“å‰æ–‡ä»¶å¤¹ `docker-compose.yaml` ä¸­ç”¨åˆ°çš„æ‰€æœ‰é•œåƒï¼Œä¸‹è½½å®Œæ¯•åä¸€èµ·è¿è¡Œã€‚ï¼ˆåœ¨ linux çš„è¯ docker-compose åº”è¯¥è¦å¦å¤–å®‰è£…ï¼‰

æ›´å¤šé…ç½®è¯·å‚è€ƒ [compose-file æ–‡æ¡£](https://docs.docker.com/compose/compose-file/)ï¼Œç¡®å®ï¼Œé…ç½® `docker-compose.yaml` ä¹Ÿæ˜¯ä¸€é—¨å­¦é—®ã€‚

å¦å¤–ï¼Œ[docker compose æ–‡æ¡£](https://docs.docker.com/compose/reference/overview/)æœ‰ `docker-compose` å‘½ä»¤ç›¸å…³çš„æ–‡æ¡£ã€‚
